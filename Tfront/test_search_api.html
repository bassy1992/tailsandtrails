<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .loading { background-color: #fff3cd; border-color: #ffeaa7; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        input, select { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
        .search-form { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .result-card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin: 10px 0; }
        .result-card img { width: 100px; height: 80px; object-fit: cover; border-radius: 4px; }
        .result-info { display: flex; align-items: center; gap: 15px; }
        .result-details { flex: 1; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Search API Test</h1>
        <p>Test the destinations search functionality</p>
        
        <div class="search-form">
            <h3>Search Parameters</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                <div>
                    <label>Search Term:</label><br>
                    <input type="text" id="searchTerm" placeholder="e.g., Cape Coast, castle, nature" style="width: 100%;">
                </div>
                <div>
                    <label>Price Category:</label><br>
                    <select id="priceFilter" style="width: 100%;">
                        <option value="">All Prices</option>
                        <option value="budget">Budget (< GH‚Çµ300)</option>
                        <option value="mid">Mid-range (GH‚Çµ300-600)</option>
                        <option value="luxury">Luxury (> GH‚Çµ600)</option>
                    </select>
                </div>
                <div>
                    <label>Duration:</label><br>
                    <select id="durationFilter" style="width: 100%;">
                        <option value="">All Durations</option>
                        <option value="day">Day Trip</option>
                        <option value="weekend">Weekend (2-3 days)</option>
                        <option value="week">Week+ (4+ days)</option>
                    </select>
                </div>
                <div>
                    <label>Category:</label><br>
                    <select id="categoryFilter" style="width: 100%;">
                        <option value="">All Categories</option>
                    </select>
                </div>
            </div>
            <div style="margin-top: 15px;">
                <button onclick="performSearch()" style="background: #28a745; color: white; border: none; border-radius: 4px;">
                    üîç Search Destinations
                </button>
                <button onclick="clearSearch()" style="background: #6c757d; color: white; border: none; border-radius: 4px;">
                    üóëÔ∏è Clear
                </button>
                <button onclick="loadCategories()" style="background: #007bff; color: white; border: none; border-radius: 4px;">
                    üìÇ Load Categories
                </button>
            </div>
        </div>

        <div id="search-result" class="test-section" style="display: none;">
            <h3>Search Results</h3>
            <div id="search-content"></div>
        </div>

        <div id="categories-result" class="test-section" style="display: none;">
            <h3>Available Categories</h3>
            <div id="categories-content"></div>
        </div>
    </div>

    <script>
        const baseUrl = 'http://localhost:8000/api';
        
        function showResult(elementId, success, data, title = '') {
            const element = document.getElementById(elementId);
            const content = document.getElementById(elementId.replace('-result', '-content'));
            
            element.style.display = 'block';
            element.className = `test-section ${success ? 'success' : 'error'}`;
            
            if (success) {
                content.innerHTML = `
                    ${title ? `<h4>${title}</h4>` : ''}
                    <div id="results-display"></div>
                `;
                
                if (elementId === 'search-result') {
                    displaySearchResults(data);
                } else {
                    content.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                }
            } else {
                content.innerHTML = `
                    <p>‚ùå <strong>Error:</strong></p>
                    <pre>${data}</pre>
                `;
            }
        }

        function showLoading(elementId, message = 'Loading...') {
            const element = document.getElementById(elementId);
            const content = document.getElementById(elementId.replace('-result', '-content'));
            
            element.style.display = 'block';
            element.className = 'test-section loading';
            content.innerHTML = `<p>‚è≥ ${message}</p>`;
        }

        function displaySearchResults(data) {
            const resultsDiv = document.getElementById('results-display');
            
            if (!data.results || data.results.length === 0) {
                resultsDiv.innerHTML = '<p>No destinations found matching your criteria.</p>';
                return;
            }

            const resultsHtml = `
                <p><strong>Found ${data.results.length} destination(s)</strong></p>
                <div>
                    ${data.results.map(dest => `
                        <div class="result-card">
                            <div class="result-info">
                                <img src="${dest.image || 'https://images.pexels.com/photos/33008767/pexels-photo-33008767.jpeg?auto=compress&cs=tinysrgb&w=100'}" 
                                     alt="${dest.name}" onerror="this.src='https://images.pexels.com/photos/33008767/pexels-photo-33008767.jpeg?auto=compress&cs=tinysrgb&w=100'">
                                <div class="result-details">
                                    <h4 style="margin: 0 0 5px 0;">${dest.name}</h4>
                                    <p style="margin: 0; color: #666;">üìç ${dest.location}</p>
                                    <p style="margin: 5px 0; color: #666;">‚è±Ô∏è ${formatDuration(dest.duration)} | üè∑Ô∏è ${dest.category?.name || 'N/A'}</p>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                                        <span style="font-weight: bold; color: #28a745;">GH‚Çµ${dest.price}</span>
                                        <span style="color: #ffc107;">‚≠ê ${dest.rating || 'N/A'}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            resultsDiv.innerHTML = resultsHtml;
        }

        function formatDuration(duration) {
            const durationMap = {
                '1_day': '1 Day',
                '2_days': '2 Days',
                '3_days': '3 Days',
                '4_days': '4 Days',
                '5_days': '5 Days',
                '6_days': '6 Days',
                '7_days': '7 Days',
                '7_plus_days': '7+ Days'
            };
            return durationMap[duration] || duration;
        }

        async function performSearch() {
            showLoading('search-result', 'Searching destinations...');
            
            try {
                const params = new URLSearchParams();
                
                const searchTerm = document.getElementById('searchTerm').value;
                const priceFilter = document.getElementById('priceFilter').value;
                const durationFilter = document.getElementById('durationFilter').value;
                const categoryFilter = document.getElementById('categoryFilter').value;
                
                if (searchTerm) params.append('search', searchTerm);
                if (priceFilter) params.append('price_category', priceFilter);
                if (durationFilter) params.append('duration_category', durationFilter);
                if (categoryFilter) params.append('category', categoryFilter);
                
                console.log('Search URL:', `${baseUrl}/destinations/?${params.toString()}`);
                
                const response = await fetch(`${baseUrl}/destinations/?${params.toString()}`);
                
                if (response.ok) {
                    const data = await response.json();
                    showResult('search-result', true, data, `Search Results (${data.results?.length || 0} found)`);
                } else {
                    const errorText = await response.text();
                    showResult('search-result', false, `Status: ${response.status}\n${errorText}`);
                }
            } catch (error) {
                showResult('search-result', false, `Network Error: ${error.message}`);
            }
        }

        async function loadCategories() {
            showLoading('categories-result', 'Loading categories...');
            
            try {
                const response = await fetch(`${baseUrl}/categories/`);
                
                if (response.ok) {
                    const data = await response.json();
                    showResult('categories-result', true, data, `Available Categories (${data.length})`);
                    
                    // Populate category dropdown
                    const categorySelect = document.getElementById('categoryFilter');
                    categorySelect.innerHTML = '<option value="">All Categories</option>';
                    data.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.id;
                        option.textContent = category.name;
                        categorySelect.appendChild(option);
                    });
                } else {
                    const errorText = await response.text();
                    showResult('categories-result', false, `Status: ${response.status}\n${errorText}`);
                }
            } catch (error) {
                showResult('categories-result', false, `Network Error: ${error.message}`);
            }
        }

        function clearSearch() {
            document.getElementById('searchTerm').value = '';
            document.getElementById('priceFilter').value = '';
            document.getElementById('durationFilter').value = '';
            document.getElementById('categoryFilter').value = '';
            
            document.getElementById('search-result').style.display = 'none';
        }

        // Load categories on page load
        window.onload = function() {
            console.log('Search API Test Page Loaded');
            loadCategories();
        };
    </script>
</body>
</html>